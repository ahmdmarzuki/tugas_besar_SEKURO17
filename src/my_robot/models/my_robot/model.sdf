<?xml version="1.0" ?>
<sdf version="1.7">

    <model name="my_robot" canonical_link="chassis">

        <link name="chassis">
            <pose relative_to="__model__">0.5 0 0.4 0 0 0</pose>
            <inertial>
            <mass>1.14395</mass>
            <inertia>
                <ixx>0.095329</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.381317</iyy>
                <iyz>0</iyz>
                <izz>0.476646</izz>
            </inertia>
            </inertial>

            <!-- VISUAL -->
            <visual name="visual">
            <geometry>
                <box>
                <size>2.0 1.0 0.5</size>
                </box>
            </geometry>
            <!-- COLOR -->
            <material>
                <ambient>0.0 0.0 0.3 1</ambient>
                <diffuse>0.0 0.0 0.4 1</diffuse>
                <specular>0.1 0.1 0.3 1</specular>
            </material>
            </visual>

            <collision name="collision">
            <geometry>
                <box>
                <size>2.0 1.0 0.5</size>
                </box>
            </geometry>
            </collision>
        </link>

        <!-- RODA KIRI -->
        <link name="left_wheel">
            <pose relative_to="chassis">-0.5 0.6 0 -1.5707 0 0</pose>
            <inertial>
            <mass>1</mass>
            <inertia>
                <ixx>0.043333</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.043333</iyy>
                <iyz>0</iyz>
                <izz>0.08</izz>
            </inertia>
            </inertial>

            <visual name="visual">
            <geometry>
                <cylinder>
                <radius>0.4</radius>
                <length>0.2</length>
                </cylinder>
            </geometry>
            <material>
                <ambient>0.05 0.05 0.05 1</ambient>
                <diffuse>0.05 0.05 0.05 1</diffuse>
                <specular>0.1 0.1 0.1 1</specular>
            </material>
            </visual>

            <collision name="collision">
            <geometry>
                <cylinder>
                <radius>0.4</radius>
                <length>0.2</length>
                </cylinder>
            </geometry>
            </collision>
        </link>

        <!-- RODA KANAN -->
        <link name="right_wheel">
            <pose relative_to="chassis">-0.5 -0.6 0 -1.5707 0 0</pose>
            <inertial>
            <mass>1</mass>
            <inertia>
                <ixx>0.043333</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.043333</iyy>
                <iyz>0</iyz>
                <izz>0.08</izz>
            </inertia>
            </inertial>

            <visual name="visual">
            <geometry>
                <cylinder>
                <radius>0.4</radius>
                <length>0.2</length>
                </cylinder>
            </geometry>
            <material>
                <ambient>0.05 0.05 0.05 1</ambient>
                <diffuse>0.05 0.05 0.05 1</diffuse>
                <specular>0.1 0.1 0.1 1</specular>
            </material>
            </visual>

            <collision name="collision">
            <geometry>
                <cylinder>
                <radius>0.4</radius>
                <length>0.2</length>
                </cylinder>
            </geometry>
            </collision>
        </link>

        <frame name="caster_frame" attached_to="chassis">
            <pose>0.6 0 -0.2 0 0 0</pose>
        </frame>

        <link name="caster">
            <pose relative_to="caster_frame"/>
            <inertial>
            <mass>1</mass>
            <inertia>
                <ixx>0.016</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.016</iyy>
                <iyz>0</iyz>
                <izz>0.016</izz>
            </inertia>
            </inertial>

            <visual name="visual">
            <geometry>
                <sphere>
                    <radius>0.2</radius>
                </sphere>
            </geometry>
            <material>
                <ambient>0.05 0.05 0.05 1</ambient>
                <diffuse>0.05 0.05 0.05 1</diffuse>
                <specular>0.1 0.1 0.1 1</specular>
            </material>
            </visual>

            <collision name="collision">
            <geometry>
                <sphere>
                    <radius>0.2</radius>
                </sphere>
            </geometry>
            </collision>
        </link>


        <!-- JOINT -->
        <joint name="left_wheel_joint" type="revolute">
            <pose relative_to="left_wheel"/>
            <parent>chassis</parent>
            <child>left_wheel</child>
            <axis>
            <xyz expressed_in="__model__">0 1 0</xyz>
            <limit>
                <lower>-1.79769e+308</lower>
                <upper>1.79769e+308</upper>
            </limit>
            </axis>
        </joint>

        <joint name="right_wheel_joint" type="revolute">
            <pose relative_to="right_wheel"/>
            <parent>chassis</parent>
            <child>right_wheel</child>
            <axis>
            <xyz expressed_in="__model__">0 1 0</xyz>
            <limit>
                <lower>-1.79769e+308</lower>
                <upper>1.79769e+308</upper>
            </limit>
            </axis>
        </joint>

        <joint name="caster_wheel" type="ball">
            <parent>chassis</parent>
            <child>caster</child>
        </joint>

        <plugin 
            filename="libignition-gazebo-diff-drive-system.so"
            name="ignition::gazebo::systems::DiffDrive">
            <left_joint>left_wheel_joint</left_joint>
            <right_joint>right_wheel_joint</right_joint>
            <wheel_separation>1.2</wheel_separation>
            <wheel_radius>0.4</wheel_radius>
            <odom_publish_frequency>1</odom_publish_frequency>
            <topic>/cmd_vel</topic>
        </plugin>

        <!-- W = MOVE FORWARD -->
        <plugin filename="gz-sim-triggered-publisher-system" name="gz::sim::systems::TriggeredPublisher">
            <input type="gz.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">87</match>
            </input>
            <output type="gz.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.5}, angular: {z: 0.0}
            </output>
        </plugin>

        <!-- S = MOVE BACKWARD -->

        <plugin filename="gz-sim-triggered-publisher-system" name="gz::sim::systems::TriggeredPublisher">
            <input type="gz.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">83</match>
            </input>
            <output type="gz.msgs.Twist" topic="/cmd_vel">
                linear: {x: -0.5}, angular: {z: 0.0}
            </output>
        </plugin>

        <!-- A = TURN LEFT -->
        <plugin filename="gz-sim-triggered-publisher-system" name="gz::sim::systems::TriggeredPublisher">
            <input type="gz.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">65</match>
            </input>
            <output type="gz.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.0}, angular: {z: 0.5}
            </output>
        </plugin>

        <!-- D = TURN RIGHT -->
        <plugin filename="gz-sim-triggered-publisher-system" name="gz::sim::systems::TriggeredPublisher">
            <input type="gz.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">68</match>
            </input>
            <output type="gz.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.0}, angular: {z: -0.5}
            </output>
        </plugin>

        <!-- LIDAR -->
        <!-- <joint name="laser_joint" type="fixed">
            <parent>chassis</parent>
            <child>laser_frame</child>
            <pose>0 0 0.4 0 0 0</pose>
        </joint>

        <link name="laser_frame">
            <pose>0 0 0.7 0 0 0</pose>
            <visual name="laser_visual">
                <pose>0 0 0 0 0 0</pose>
                <geometry>
                    <cylinder>
                        <radius>0.2</radius>
                        <length>0.1</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1.0</ambient> 
                    <diffuse>1.0 0.0 0.0 1.0</diffuse>
                    <specular>0.5 0.0 0.0 1.0</specular> 
                </material>
            </visual>
            <collision name="laser_collision">
                <geometry>
                    <cylinder>
                        <radius>0.05</radius>
                        <length>0.01</length>
                    </cylinder>
                </geometry>
            </collision>    
        </link>  -->

        <!-- <plugin
            filename="gz-sim-sensors-system"
            name="gz::sim::systems::Sensors">
            <render_engine>ogre2</render_engine>
        </plugin> -->

        <!-- <plugin name="gazebo_ros_laser" filename="libgazebo_ros_laser.so">
            <topicName>/scan</topicName>
        </plugin> -->


        <!-- <link name="camera_link">
            <pose>0 0 0.7 0 0 0</pose>
            <visual name="camera_visual">
                <pose>0 0 0 0 0 0</pose>
                <geometry>
                    <cylinder>
                        <radius>0.2</radius>
                        <length>0.1</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1.0</ambient> 
                    <diffuse>1.0 0.0 0.0 1.0</diffuse>
                    <specular>0.5 0.0 0.0 1.0</specular> 
                </material>
            </visual>
            <collision name="camera_collision">
                <geometry>
                    <cylinder>
                        <radius>0.05</radius>
                        <length>0.01</length>
                    </cylinder>
                </geometry>
            </collision>   
        </link> -->

        <link name="camera_link">
            <gazebo>
                <sensor name="camera" type="camera">
                    <camera name="camera">
                        <horizontal_fov>1.3962634</horizontal_fov>
                        <image>
                            <width>640</width>
                            <height>480</height>
                            <format>R8G8B8</format>
                        </image>
                        <clip>
                            <near>0.1</near>
                            <far>100</far>
                        </clip>
                        <noise>
                            <type>gaussian</type>
                            <mean>0.0</mean>
                            <stddev>0.007</stddev>
                        </noise>
                    </camera>
                </sensor>
            </gazebo>
            <pose>0 0 0.7 0 0 0</pose>
            <visual name="camera_visual">
                <pose>0 0 0 0 0 0</pose>
                <geometry>
                    <cylinder>
                        <radius>0.2</radius>
                        <length>0.1</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1.0</ambient> 
                    <diffuse>1.0 0.0 0.0 1.0</diffuse>
                    <specular>0.5 0.0 0.0 1.0</specular> 
                </material>
            </visual>
            <collision name="camera_collision">
                <geometry>
                    <cylinder>
                        <radius>0.05</radius>
                        <length>0.01</length>
                    </cylinder>
                </geometry>
            </collision>   
        </link>

        <joint name="camera_joint" type="fixed">
            <parent>chassis</parent>
            <child>camera_link</child>
            <pose>0 0 0.7 0 0 0</pose>
        </joint>

        
        


        <plugin name="gazebo_ros_camera" filename="libgazebo_ros_camera.so">
            <camera_name>camera</camera_name>
            <image_topic_name>/camera/image_raw</image_topic_name>
            <camera_info_topic_name>/camera/camera_info</camera_info_topic_name>
            <frame_name>camera_link</frame_name>
        </plugin>



    </model>

    
    
    

</sdf>